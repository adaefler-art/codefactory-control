{
  "version": "0.7.0",
  "lawbookId": "AFU9-LAWBOOK",
  "lawbookVersion": "2025-12-30.1",
  "createdAt": "2025-12-30T10:00:00.000Z",
  "createdBy": "system",
  "notes": "Initial AFU-9 lawbook for enforcement and remediation gates",
  "github": {
    "allowedRepos": [
      "adaefler-art/codefactory-control",
      "adaefler-art/afu9-examples"
    ]
  },
  "determinism": {
    "requireDeterminismGate": true,
    "requirePostDeployVerification": true
  },
  "remediation": {
    "enabled": true,
    "allowedPlaybooks": [
      "SAFE_RETRY_RUNNER",
      "RERUN_VERIFICATION",
      "ECS_FORCE_NEW_DEPLOY"
    ],
    "allowedActions": [
      "runner_dispatch",
      "verification_run",
      "ecs_force_new_deploy",
      "github_workflow_dispatch"
    ],
    "maxRunsPerIncident": 3,
    "cooldownMinutes": 15
  },
  "automationPolicy": {
    "enforcementMode": "strict",
    "policies": [
      {
        "actionType": "rerun_checks",
        "description": "Rerun failed GitHub workflow checks",
        "allowedEnvs": ["staging", "prod"],
        "cooldownSeconds": 300,
        "maxRunsPerWindow": 3,
        "windowSeconds": 3600,
        "idempotencyKeyTemplate": ["owner", "repo", "prNumber", "runId"],
        "requiresApproval": false
      },
      {
        "actionType": "merge_pr",
        "description": "Merge pull request",
        "allowedEnvs": ["staging"],
        "cooldownSeconds": 60,
        "maxRunsPerWindow": 5,
        "windowSeconds": 1800,
        "idempotencyKeyTemplate": ["owner", "repo", "prNumber"],
        "requiresApproval": true
      },
      {
        "actionType": "prod_deploy",
        "description": "Deploy to production environment",
        "allowedEnvs": ["prod"],
        "cooldownSeconds": 600,
        "maxRunsPerWindow": 2,
        "windowSeconds": 7200,
        "idempotencyKeyTemplate": ["targetEnv", "deploymentId"],
        "requiresApproval": true
      },
      {
        "actionType": "workflow_dispatch",
        "description": "Trigger GitHub workflow via dispatch event",
        "allowedEnvs": ["staging", "prod"],
        "cooldownSeconds": 120,
        "maxRunsPerWindow": 10,
        "windowSeconds": 3600,
        "idempotencyKeyTemplate": ["owner", "repo", "workflowId"],
        "requiresApproval": false
      },
      {
        "actionType": "ecs_force_new_deploy",
        "description": "Force new ECS deployment",
        "allowedEnvs": ["staging"],
        "cooldownSeconds": 180,
        "maxRunsPerWindow": 3,
        "windowSeconds": 3600,
        "idempotencyKeyTemplate": ["clusterName", "serviceName"],
        "requiresApproval": false
      },
      {
        "actionType": "rollback_deployment",
        "description": "Rollback deployment to previous version",
        "allowedEnvs": ["staging", "prod"],
        "cooldownSeconds": 300,
        "maxRunsPerWindow": 2,
        "windowSeconds": 7200,
        "idempotencyKeyTemplate": ["targetEnv", "deploymentId"],
        "requiresApproval": true
      }
    ]
  },
  "evidence": {
    "requiredKindsByCategory": {
      "deployment": [
        "deploy_status",
        "verification_result"
      ],
      "security": [
        "code_scan",
        "secret_scan"
      ]
    },
    "maxEvidenceItems": 100
  },
  "enforcement": {
    "requiredFields": [
      "lawbookVersion",
      "verdictId",
      "timestamp"
    ],
    "strictMode": true
  },
  "ui": {
    "displayName": "AFU-9 Production Lawbook v1"
  }
}
